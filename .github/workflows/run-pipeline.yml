name: Run Fraud Detection Pipeline

on:
  workflow_dispatch:  # Manual trigger
  schedule:
    - cron: '0 0 * * 0'  # Run weekly on Sunday at midnight UTC

jobs:
  run-fraud-detection:
    name: Execute Fraud Detection Pipeline
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install numpy pandas scikit-learn mlflow matplotlib seaborn python-dotenv pyyaml joblib
    
    - name: Run fraud detection pipeline
      run: |
        python run_simple_fraud_detection.py
    
    - name: Upload model artifacts
      uses: actions/upload-artifact@v4
      with:
        name: fraud-detection-model
        path: |
          models/
          mlruns/
        retention-days: 30
    
    - name: Generate performance report
      run: |
        echo "# Fraud Detection Pipeline Results" > report.md
        echo "" >> report.md
        echo "## Execution Details" >> report.md
        echo "- Date: $(date)" >> report.md
        echo "- Python Version: $(python --version)" >> report.md
        echo "" >> report.md
        echo "## Model Performance" >> report.md
        echo "See artifacts for detailed metrics" >> report.md
    
    - name: Upload report
      uses: actions/upload-artifact@v4
      with:
        name: performance-report
        path: report.md
        retention-days: 30
